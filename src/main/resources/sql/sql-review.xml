<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="bitc.fullstack405.team2.review.ReviewMapper">

    <select id="selectReviewList" resultType="bitc.fullstack405.team2.review.ReviewDTO">
        SELECT
            c.board_idx, c.comm_title, c.contents, c.create_user, c.createAt,
            c.hit_cnt, t.title AS theme_title, ca.name AS cafe_name
        FROM
            communication c
        LEFT JOIN
            theme t ON c.comm_theme_idx = t.theme_idx
        LEFT JOIN
            cafe ca ON c.cafe_id = ca.cafe_id
        WHERE
            c.deleted_yn = 'N'
        ORDER BY
            c.board_idx DESC
    </select>

    <!-- review 게시글 조회수 증가 -->
    <update id="updateHitCount" parameterType = "int">
        UPDATE
            communication
        SET
            hit_cnt = hit_cnt + 1
        WHERE
            board_idx = #{boardIdx}
    </update>

    <!-- review 게시물 상세, 수정 화면 -->
    <select id="selectReviewDetail" parameterType="int" resultType="bitc.fullstack405.team2.review.ReviewDTO">
        SELECT
            c.board_idx, c.comm_title, c.contents, c.create_user, c.createAt,
            c.hit_cnt, t.title AS theme_title, ca.name AS cafe_name, c.comm_image
        FROM
            communication c
        LEFT JOIN
            theme t ON c.comm_theme_idx = t.theme_idx
        LEFT JOIN
            cafe ca ON c.cafe_id = ca.cafe_id
        WHERE
            c.deleted_yn = 'N'
        AND
            c.board_idx = #{boardIdx}
        ORDER BY
            c.board_idx DESC
    </select>
</mapper>